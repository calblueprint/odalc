{% extends "base/base.html" %}

{% load staticfiles %}

{% block title %}Donate{% endblock %}

{% block is_donate_page %}active{% endblock %}

{% block body %}
<div class="white-section">
    <div class="row">
        <div class="large-5 columns">
            <h1>Donate</h1>
            <p>
            Your support helps keeps this program running and allows us to reach more underserved communities with the knowledge and skills they need.
            Together, we can help these communities achieve economic success and empowerment through digital literacy.
            By donating to Oakland Digital, you are helping to close the digital literacy and opportunity gap.
            </p>

            <form method='POST'>
            {% csrf_token %}
            <div class="row">
                <div class="small-8 columns">
                    <div class="range-slider round" id='donate-amt' data-slider data-options="start: 1; end: 50;">
                      <span id="donate-amt-handle" class="range-slider-handle slider-dollar"></span>
                      <span class="range-slider-active-segment"></span>
                      <input type="hidden">
                    </div>
                </div>
                <div class="small-3 small-offset-1 columns">
                    <div class="row collapse">
                        <div class="small-2 columns">
                            <span data-tooltip class="prefix has-tip tip-bottom" title="If you would like to, you can input more than the $50.00 limit on the slider in the input box. We really appreciate your generosity!">$</span>
                        </div>
                        <div class="small-10 columns">
                            <input type="number" name="quantity" min="0" id='donate-amt-box'>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="small-12 columns">
                    <button class="btn success right" id='donate-btn'>Donate</button>
                </div>
            </div>

            </form>
            <p><small>All contributions are tax-exempt to the extent allowed by law. Oakland Digital Arts and Literacy Center Inc is a 501(c)(3) nonprofit organization: Federal Tax 27-0720655. We respond to each donation with a charitable donation letter for your tax records, and we never share your information with other organizations.
            </small></p>
        </div>
        <div class="large-7 columns">
            <img src="{% static "base/img/show-learning.jpg" %}"/>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    <script src="https://checkout.stripe.com/v2/checkout.js"></script>
    <script>
        $(document).ready(function() {
          $("#donate-btn").click(function(){
              console.log('click!')
              var token = function(res){
                var $input = $('<input type=hidden name=stripeToken />').val(res.id);
                $('form').append($input).submit();
              };

              StripeCheckout.open({
                key:         '{{ stripe_public_key }}',
                amount: $('#donate-amt-box').val() * 100,
                currency:    'usd',
                name:'Donate to ODALC',
                description: 'Thank you for your generosity!',
                panelLabel:  'Donate',
                allowRememberMe: false,
                token:       token
              });

              return false;
            });

          $('[data-slider]').on('change', function(){
              $('#donate-amt-box').val($('#donate-amt').attr('data-slider'));
            });

          $('#donate-amt-box').on('change',function(){
              var newValue = $('#donate-amt-box').val();
              if(!isNaN(newValue)){
                if(newValue <= 50){
                  $('#donate-amt').foundation(
                    'slider',
                    'set_value',
                    newValue
                  );
                } else{
                  $('#donate-amt').foundation('slider','set_value',50);
                  $('#donate-amt-box').val(newValue);
                }
              };
          });
        });
    </script>
{% endblock %}
